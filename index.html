<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Meal & Play</title>
    <meta name="description" content="L'asilo a portata di mano">
    <meta name="theme-color" content="#06b6d4">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Menu Asilo Magic">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(160deg, #0ea5e9 0%, #06b6d4 40%, #14b8a6 100%);
            color: #1e293b;
            line-height: 1.4;
            min-height: 100vh;
            padding: 0.5rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0.5rem;
        }

        header {
            text-align: center;
            margin-bottom: 0.3rem;
            padding: 0.4rem;
        }

        h1 {
            color: #ffffff;
            font-weight: 700;
            font-size: 1.5rem;
            margin-bottom: 0;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        }

        .week-info {
            color: #e9d5ff;
            font-size: 1.2rem;
            font-weight: 400;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .nav-tab {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            color: #333333;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: #ffffff;
            box-shadow: 0 8px 30px rgba(66, 153, 225, 0.4);
            transform: scale(1.05);
        }

        .section {
            background: linear-gradient(135deg, #ffffff 0%, #f0fdfa 100%);
            border-radius: 16px;
            padding: 0.8rem;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        .section.hidden {
            display: none;
        }

        .selectors {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .selector-btn {
            padding: 0.8rem 1.8rem;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ff7b00 0%, #e91e63 100%);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .selector-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .selector-btn.active {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            box-shadow: 0 8px 30px rgba(66, 153, 225, 0.4);
            border: 3px solid #2b6cb0;
        }

        /* Activities section specific layout - 2x2 grid */
        #activities-section .selectors {
            max-width: 400px;
            margin: 0 auto 2rem;
        }

        #activities-section .selector-btn {
            flex: 0 0 calc(50% - 0.5rem);
            min-width: 0;
            height: auto;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            white-space: nowrap;
        }

        .quick-view-header {
            text-align: center;
            margin-bottom: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: linear-gradient(135deg, #06b6d4 0%, #14b8a6 100%);
            border-radius: 12px;
            color: white;
            display: inline-block;
        }

        .quick-view-header h2 {
            font-size: 0.95rem;
            font-weight: 600;
            margin: 0;
        }

        .menu-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 0.8rem;
            margin-bottom: 1rem;
        }

        .day-card {
            background: linear-gradient(135deg, #ffffff 0%, #f0fdfa 100%);
            border-radius: 14px;
            padding: 0.8rem;
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(6, 182, 212, 0.15);
        }

        .day-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #06b6d4, #14b8a6, #22c55e);
            border-radius: 14px 14px 0 0;
        }

        .day-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(6, 182, 212, 0.15);
        }

        .day-card.today {
            background: linear-gradient(135deg, #ecfeff 0%, #cffafe 100%);
            border-color: #06b6d4;
        }

        .day-card.today::before {
            background: linear-gradient(90deg, #06b6d4, #14b8a6, #22c55e);
        }

        .day-card h2 {
            color: #0f766e;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .menu-list {
            margin-top: 0.3rem;
        }

        .menu-item {
            margin-bottom: 0.2rem;
            padding: 0.15rem 0;
            color: #334155;
            font-size: 0.8rem;
            line-height: 1.3;
            border-left: 2px solid;
            padding-left: 0.5rem;
        }

        .menu-item:nth-child(1) { border-left-color: #f97316; }
        .menu-item:nth-child(2) { border-left-color: #06b6d4; }
        .menu-item:nth-child(3) { border-left-color: #22c55e; }

        .activities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 0.8rem;
        }

        .activity-day-card {
            background: linear-gradient(135deg, #ffffff 0%, #f0fdfa 100%);
            border-radius: 12px;
            padding: 0.6rem;
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(6, 182, 212, 0.15);
            border-left: 3px solid #14b8a6;
        }

        .activity-day-card.today {
            background: linear-gradient(135deg, #ecfeff 0%, #cffafe 100%);
            border-color: #06b6d4;
        }

        .activity-day-card h3 {
            color: #0f766e;
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
            text-align: center;
        }

        .activity-moment {
            margin-bottom: 0.3rem;
            padding: 0.3rem;
        }

        .activity-moment-title {
            color: #0891b2;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 0.1rem;
        }

        .activity-moment-content {
            color: #334155;
            font-size: 0.85rem;
        }

        .add-combination-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #06b6d4 0%, #14b8a6 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.25);
            margin: 0.5rem auto;
            display: block;
        }

        .add-combination-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(6, 182, 212, 0.35);
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #718096;
            font-style: italic;
        }

        footer {
            text-align: center;
            margin-top: 1rem;
            padding: 0.5rem;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.75rem;
        }

        .section.hidden {
            display: none;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: #4a5568;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.15);
        }

        .combinations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 0.8rem;
            margin-top: 0.5rem;
        }

        .combination-card {
            background: linear-gradient(135deg, #ffffff 0%, #f0fdfa 100%);
            border-radius: 14px;
            padding: 0.8rem;
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.1);
            transition: all 0.3s ease;
            border: 1px solid rgba(6, 182, 212, 0.15);
            position: relative;
            border-left: 3px solid #14b8a6;
        }

        .combination-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(6, 182, 212, 0.15);
        }

        .combination-card h3 {
            color: #0f766e;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
            text-align: left;
            padding-right: 40px;
        }

        .combination-card p {
            color: #64748b;
            font-size: 0.8rem;
            margin-bottom: 0.3rem;
        }

        .combination-actions {
            display: flex;
            gap: 0.4rem;
            margin-top: 0.5rem;
        }

        .combination-actions .modal-btn {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .section-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .section-btn.cancel {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
            color: #475569;
        }

        .section-btn.save {
            background: linear-gradient(135deg, #06b6d4 0%, #14b8a6 100%);
            color: white;
            box-shadow: 0 3px 12px rgba(6, 182, 212, 0.25);
        }

        .section-btn:hover {
            transform: translateY(-2px);
        }

        /* Modal styles for existing combination and delete modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 25px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .modal-header h2 {
            color: #2d3748;
            font-size: 1.8rem;
            font-weight: 600;
        }

        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }

        .modal-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn.cancel {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e0 100%);
            color: #4a5568;
        }

        .modal-btn.save {
            background: linear-gradient(135deg, #06b6d4 0%, #14b8a6 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
        }

        .modal-btn:hover {
            transform: translateY(-2px);
        }

        .current-info {
            margin: 0.3rem 0;
            padding: 0.5rem;
        }

        .current-info h4 {
            color: #0f766e;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .menu-preview,
        .activity-preview {
            margin: 0.5rem 0;
        }

        .menu-preview strong,
        .activity-preview strong {
            color: #4a5568;
            font-size: 0.9rem;
        }

        .menu-preview small,
        .activity-preview small {
            color: #2d3748;
            font-size: 0.8rem;
            line-height: 1.3;
            display: block;
            margin: 0.2rem 0;
        }

        .no-data {
            color: #718096;
            font-style: italic;
            font-size: 0.85rem;
            margin: 0.5rem 0;
        }

        .mini-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            z-index: 10;
        }

        .mini-toggle-btn {
            padding: 0.25rem 0.6rem;
            border: none;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            box-shadow: 0 2px 6px rgba(6, 182, 212, 0.25);
            white-space: nowrap;
        }

        .mini-toggle-btn:active {
            background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%);
            transform: scale(0.95);
            box-shadow: 0 1px 3px rgba(6, 182, 212, 0.3);
        }

        /* Swipe container for mobile */
        .swipe-container {
            position: relative;
            overflow: hidden;
            touch-action: pan-y;
        }

        .swipe-wrapper {
            display: flex;
            transition: transform 0.3s ease;
            width: 200%;
        }

        .swipe-slide {
            width: 50%;
            flex-shrink: 0;
        }

        /* Swipe indicators for mobile */
        .swipe-indicators {
            display: none;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .swipe-indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(6, 182, 212, 0.3);
            transition: all 0.3s ease;
        }

        .swipe-indicator.active {
            background: linear-gradient(135deg, #06b6d4 0%, #14b8a6 100%);
            transform: scale(1.3);
        }

        .combination-card.deleting {
            animation: deletePulse 1.5s ease-in-out;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe0e0 100%) !important;
            border-color: #f56565 !important;
        }

        @keyframes deletePulse {
            0% { transform: scale(1); }
            25% { transform: scale(0.95); }
            50% { transform: scale(1.05); }
            75% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        .mini-toggle-switch {
            position: relative;
            display: inline-block;
            width: 36px;
            height: 20px;
        }

        .mini-toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .mini-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #ff9a56 0%, #ff8fab 100%);
            transition: .4s;
            border-radius: 34px;
            box-shadow: 0 1px 4px rgba(255, 154, 86, 0.3);
        }

        .mini-toggle-slider:before {
            position: absolute;
            content: "";
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .mini-toggle-slider {
            background: linear-gradient(135deg, #ff6b95 0%, #ff8fab 100%);
            box-shadow: 0 1px 4px rgba(255, 107, 149, 0.3);
        }

        input:checked + .mini-toggle-slider:before {
            transform: translateX(16px);
        }

        .delete-icon {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            z-index: 10;
            box-shadow: 0 2px 6px rgba(239, 68, 68, 0.25);
        }

        .delete-icon:hover {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            transform: scale(1.1);
            box-shadow: 0 3px 10px rgba(239, 68, 68, 0.35);
        }

        .mobile-day-tab {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ff9a56 0%, #ff8fab 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 154, 86, 0.3);
        }

        .mobile-day-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .mobile-day-tab.active {
            background: linear-gradient(135deg, #ff6b95 0%, #ff8fab 100%);
            box-shadow: 0 8px 30px rgba(255, 107, 149, 0.4);
        }

        .tomorrow-info {
            display: none;
        }

        .mobile-day-tab {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ff9a56 0%, #ff8fab 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 154, 86, 0.3);
        }


        /* Responsive design */
        @media (max-width: 768px) {
            body {
                padding: 0.3rem;
            }

            .container {
                padding: 0.3rem;
            }

            header {
                padding: 0.3rem;
                margin-bottom: 0.2rem;
            }

            h1 {
                font-size: 1.3rem;
            }

            .nav-tabs {
                gap: 0.3rem;
            }

            .nav-tab {
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
            }

            .section {
                padding: 0.6rem;
                border-radius: 14px;
            }

            .menu-container {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .activities-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .modal-content {
                padding: 1rem;
                margin: 0.5rem;
                border-radius: 16px;
            }

            .combinations-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
                margin-top: 0.3rem;
            }

            .mobile-day-toggle {
                display: flex;
            }

            .combination-card {
                padding: 0.6rem;
                border-radius: 12px;
            }

            .combination-card h3 {
                font-size: 1rem;
                margin-bottom: 0.2rem;
                padding-right: 30px;
            }

            .combination-card p {
                font-size: 0.7rem;
                margin-bottom: 0.2rem;
            }

            .current-info {
                margin: 0.2rem 0;
                padding: 0.3rem;
            }

            .current-info h4 {
                font-size: 0.8rem;
                margin-bottom: 0.2rem;
            }

            .menu-item {
                font-size: 0.75rem;
                margin-bottom: 0.15rem;
                padding: 0.1rem 0;
                padding-left: 0.4rem;
            }

            .activity-preview {
                margin: 0.2rem 0;
            }

            .activity-preview strong {
                font-size: 0.75rem;
            }

            .activity-preview small {
                font-size: 0.7rem;
            }

            .combination-actions {
                margin-top: 0.4rem;
                gap: 0.3rem;
            }

            .section-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.75rem;
                border-radius: 15px;
            }

            .add-combination-btn {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
                margin: 0.4rem auto;
            }

            .delete-icon {
                width: 20px;
                height: 20px;
                font-size: 12px;
                top: 0.4rem;
                right: 0.4rem;
            }

            .swipe-indicators {
                margin-top: 0.3rem;
            }

            /* Hide desktop toggle button on mobile */
            .mini-toggle-btn.desktop-only {
                display: none;
            }

            /* Show swipe indicators on mobile */
            .swipe-indicators {
                display: flex;
            }

            footer {
                margin-top: 0.5rem;
                padding: 0.3rem;
                font-size: 0.65rem;
            }
        }

        /* Desktop only - hide swipe indicators */
        @media (min-width: 769px) {
            .swipe-indicators {
                display: none;
            }

            .swipe-container {
                overflow: visible;
            }

            .swipe-wrapper {
                display: block;
                width: 100%;
            }

            .swipe-slide {
                width: 100%;
            }

            .swipe-slide.tomorrow-slide {
                display: none;
            }

            .swipe-slide.tomorrow-slide.visible {
                display: block;
            }

            .swipe-slide.today-slide.hidden {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Meal & Play</h1>
        </header>

        <main class="container">
            <section id="favorites-section" class="section">
            <div id="install-prompt-container" style="display: none; margin-bottom: 0.8rem;">
                <div style="background: linear-gradient(135deg, #06b6d4 0%, #14b8a6 100%); color: white; padding: 0.8rem; border-radius: 14px; text-align: center; box-shadow: 0 4px 15px rgba(6, 182, 212, 0.25);">
                    <h3 style="margin: 0 0 0.3rem 0; font-size: 0.95rem;">üì± Installa Meal & Play</h3>
                    <p style="margin: 0 0 0.5rem 0; font-size: 0.8rem; opacity: 0.9;">Accesso rapido dalla home!</p>
                    <button id="install-btn" style="background: white; color: #0f766e; border: none; padding: 0.5rem 1.2rem; border-radius: 20px; font-weight: 600; cursor: pointer; font-size: 0.85rem; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(0, 0, 0, 0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 3px 10px rgba(0, 0, 0, 0.15)'">
                        Installa
                    </button>
                </div>
            </div>
            <div id="favorites-content">
                <div class="loading">Nessun preferito salvato. Clicca su "Aggiungi" per iniziare!</div>
            </div>
            
            <div id="create-favorite-container" style="text-align: center; margin-top: 0.8rem; display: none;">
                <button class="add-combination-btn" onclick="openCombinationModal()">
                    Aggiungi
                </button>
            </div>
        </section>

            <!-- Full Menu Section -->
            <section id="full-menu-section" class="section hidden">
                <div style="margin-bottom: 0.8rem;">
                    <button class="section-btn cancel" onclick="showFavorites()" style="margin-bottom: 0.5rem;">
                        ‚Üê Preferiti
                    </button>
                    <div class="modal-header" style="margin-bottom: 0.5rem;">
                        <h2 id="full-menu-title" style="font-size: 1.1rem; color: #0f766e;">Menu</h2>
                    </div>
                </div>
                <div id="full-menu-content">
                    <div class="loading">Caricamento menu in corso...</div>
                </div>
            </section>

            <!-- Full Activities Section -->
            <section id="full-activities-section" class="section hidden">
                <div style="margin-bottom: 0.8rem;">
                    <button class="section-btn cancel" onclick="showFavorites()" style="margin-bottom: 0.5rem;">
                        ‚Üê Preferiti
                    </button>
                    <div class="modal-header" style="margin-bottom: 0.5rem;">
                        <h2 id="full-activities-title" style="font-size: 1.1rem; color: #0f766e;">Attivit√†</h2>
                    </div>
                </div>
                <div id="full-activities-content">
                    <div class="loading">Caricamento attivit√† in corso...</div>
                </div>
            </section>
        </main>

        <footer>
            <p>Made with love for little ones</p>
            <p id="config-date"></p>
        </footer>
    </div>

    <!-- Combination Modal -->
    <div id="combination-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Crea il tuo Preferito</h2>
            </div>
            <form id="combination-form">
                <div class="form-group">
                    <label for="combination-name">Nome</label>
                    <input type="text" id="combination-name" placeholder="Dai un nome alla tua combinazione..." required>
                </div>
                <div class="form-group">
                    <label for="combination-menu">Tipo Menu</label>
                    <select id="combination-menu" required>
                        <option value="nido">Piccoli</option>
                        <option value="infanzia">Grandi</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="combination-activity">Gruppo Attivit√†</label>
                    <select id="combination-activity" required>
                        <option value="nido">Nido</option>
                        <option value="primavera">Primavera</option>
                        <option value="infanzia1">Infanzia 1</option>
                        <option value="infanzia2">Infanzia 2</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn cancel" onclick="closeCombinationModal()">Annulla</button>
                    <button type="submit" class="modal-btn save">Salva</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Conferma Eliminazione</h2>
            </div>
            <p style="text-align: center; margin-bottom: 2rem; color: #4a5568;">Sei sicuro di voler eliminare questo preferito?</p>
            <div class="modal-actions">
                <button type="button" class="modal-btn cancel" onclick="closeDeleteModal()">Annulla</button>
                <button type="button" class="modal-btn save" onclick="confirmDelete()">Elimina</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentTab = 'favorites';
        let currentMenuType = 'nido';
        let currentActivityGroup = 'nido';
        let MENU_NIDO = {};
        let MENU_INFANZIA = {};
        let ACTIVITIES = {};
        let WEEK_1_MONDAY = '';
        let combinations = [];
        let editingCombinationId = null;
        let deleteTargetId = null;
        let deferredPrompt = null;

        // Utility functions
        function getCurrentDay(date) {
            const days = ['Domenica', 'Luned√¨', 'Marted√¨', 'Mercoled√¨', 'Gioved√¨', 'Venerd√¨', 'Sabato'];
            return days[date.getDay()];
        }

        function getWeekNumber(date) {
            const startDate = new Date(WEEK_1_MONDAY);
            const diffTime = date.getTime() - startDate.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const weekNum = Math.floor(diffDays / 7) + 1;
            return Math.max(1, Math.min(4, weekNum));
        }

        // Load data functions
        async function loadWeekConfig() {
            try {
                const timestamp = Date.now();
                const response = await fetch(`week-config.txt?t=${timestamp}`);
                const text = await response.text();
                WEEK_1_MONDAY = text.trim();
                console.log('Week config loaded:', WEEK_1_MONDAY);
            } catch (error) {
                console.error('Error loading week config:', error);
                WEEK_1_MONDAY = '2025-09-30'; // Default
            }
        }

        function loadCombinations() {
            const saved = localStorage.getItem('combinations');
            if (saved) {
                combinations = JSON.parse(saved);
            }
            console.log('Loaded combinations:', combinations);
        }

        function saveCombinations() {
            localStorage.setItem('combinations', JSON.stringify(combinations));
            console.log('Saved combinations:', combinations);
        }

        function openCombinationModal(combinationId = null) {
            const modal = document.getElementById('combination-modal');
            const form = document.getElementById('combination-form');
            const modalTitle = document.getElementById('modal-title');
            
            if (combinationId) {
                // Edit mode
                editingCombinationId = combinationId;
                const combination = combinations.find(c => c.id === combinationId);
                
                if (combination) {
                    document.getElementById('combination-name').value = combination.name;
                    document.getElementById('combination-menu').value = combination.menuType;
                    document.getElementById('combination-activity').value = combination.activityGroup;
                }
                modalTitle.textContent = 'Modifica Preferito';
            } else {
                // Create mode
                editingCombinationId = null;
                form.reset();
                modalTitle.textContent = '';
            }
            
            modal.classList.add('active');
        }

        function closeCombinationModal() {
            const modal = document.getElementById('combination-modal');
            modal.classList.remove('active');
            editingCombinationId = null;
        }

        async function loadMenuData() {
            try {
                const timestamp = Date.now();
                const [nidoResponse, infanziaResponse] = await Promise.all([
                    fetch(`menu-nido.txt?t=${timestamp}`),
                    fetch(`menu-infanzia.txt?t=${timestamp}`)
                ]);
                
                const nidoText = await nidoResponse.text();
                const infanziaText = await infanziaResponse.text();
                
                MENU_NIDO = parseMenuData(nidoText);
                MENU_INFANZIA = parseMenuData(infanziaText);
                console.log('Menu data loaded:', { 
                    nido: Object.keys(MENU_NIDO).length, 
                    infanzia: Object.keys(MENU_INFANZIA).length 
                });
            } catch (error) {
                console.error('Error loading menu data:', error);
            }
        }

        function parseMenuData(text) {
            const menu = {};
            const lines = text.split('\n');
            
            const dayMap = {
                '1': 'Luned√¨',
                '2': 'Marted√¨', 
                '3': 'Mercoled√¨',
                '4': 'Gioved√¨',
                '5': 'Venerd√¨'
            };
            
            for (const line of lines) {
                if (line.trim() === '' || line.startsWith('#')) {
                    continue;
                }
                
                const parts = line.split('|').map(p => p.trim());
                if (parts.length >= 5) {
                    const weekNum = parseInt(parts[0]);
                    const dayNum = parts[1];
                    const primo = parts[2];
                    const secondo = parts[3];
                    const frutta = parts[4];
                    
                    if (weekNum >= 1 && weekNum <= 4 && dayMap[dayNum]) {
                        if (!menu[weekNum]) {
                            menu[weekNum] = {};
                        }
                        menu[weekNum][dayMap[dayNum]] = { primo, secondo, frutta };
                    }
                }
            }
            
            return menu;
        }

        async function loadActivitiesData() {
            try {
                const timestamp = Date.now();
                const response = await fetch(`activities.txt?t=${timestamp}`);
                const text = await response.text();
                ACTIVITIES = parseActivitiesData(text);
                console.log('Activities data loaded:', Object.keys(ACTIVITIES).length);
            } catch (error) {
                console.error('Error loading activities data:', error);
            }
        }

        function parseActivitiesData(text) {
            const activities = {};
            const lines = text.split('\n');
            
            // Day mapping (1=Luned√¨, 2=Marted√¨, etc.)
            const dayMap = {
                '1': 'Luned√¨',
                '2': 'Marted√¨', 
                '3': 'Mercoled√¨',
                '4': 'Gioved√¨',
                '5': 'Venerd√¨',
                '6': 'Sabato'
            };
            
            for (const line of lines) {
                if (line.trim() === '' || line.startsWith('#')) {
                    continue;
                }
                
                // Parse format: gruppo|giorno|attivita_mattino|attivita_pomeriggio
                const parts = line.split('|').map(p => p.trim());
                if (parts.length >= 4) {
                    const group = parts[0];
                    const dayNum = parts[1];
                    const mattino = parts[2];
                    const pomeriggio = parts[3];
                    
                    if (dayMap[dayNum]) {
                        if (!activities[group]) {
                            activities[group] = {};
                        }
                        
                        const dayName = dayMap[dayNum];
                        
                        // Store activities as separate morning and afternoon items
                        activities[group][dayName] = {
                            mattino: mattino !== '-' ? mattino : null,
                            pomeriggio: pomeriggio !== '-' ? pomeriggio : null
                        };
                    }
                }
            }
            
            return activities;
        }

        // Display functions
        function displayFavorites() {
            const favoritesContent = document.getElementById('favorites-content');
            const createContainer = document.getElementById('create-favorite-container');
            
            if (combinations.length === 0) {
                favoritesContent.innerHTML = `
                    <div class="loading">Nessun preferito salvato. Clicca su "Crea il tuo Preferito" per iniziare!</div>
                `;
                createContainer.style.display = 'block';
                return;
            }
            
            // Show create button at bottom if there are favorites
            createContainer.style.display = 'block';
            
            let html = '<div class="combinations-grid">';
            combinations.forEach(combination => {
                const currentData = getCurrentMenuAndActivities(combination.menuType, combination.activityGroup);
                const menuTypeName = combination.menuType === 'nido' ? 'Piccoli' : 'Grandi';
                const activityGroupName = getActivityGroupName(combination.activityGroup);
                
                html += `
                    <div class="combination-card">
                        <button class="delete-icon" onclick="openDeleteModal('${combination.id}')" title="Rimuovi preferito">√ó</button>
                        <h3>${combination.name}</h3>
                        <p style="color: #718096; font-size: 0.9rem; margin-bottom: 1rem;">
                            Menu: ${menuTypeName} | Attivit√†: ${activityGroupName}
                        </p>
                        
                        <div class="swipe-container" data-combination-id="${combination.id}">
                            <div class="swipe-wrapper" id="swipe-wrapper-${combination.id}">
                                <div class="swipe-slide today-slide" id="today-slide-${combination.id}">
                                    <div class="current-info">
                                        <h4>Oggi - ${currentData.today.day} <button class="mini-toggle-btn desktop-only" id="toggle-btn-${combination.id}" onclick="toggleDayView('${combination.id}')" style="float: right;">Vai a domani</button></h4>
                                        ${currentData.today.menu ? `
                                            <div class="menu-list">
                                                <p class="menu-item">${currentData.today.menu.primo}</p>
                                                <p class="menu-item">${currentData.today.menu.secondo}</p>
                                                <p class="menu-item">${currentData.today.menu.frutta}</p>
                                            </div>
                                        ` : '<p class="no-data">Nessun menu oggi</p>'}
                                        ${currentData.today.activity ? `
                                            <div class="activity-preview">
                                                <strong>Attivit√†:</strong><br>
                                                <small>${currentData.today.activity.replace(/<br>/g, ' ‚Ä¢ ')}</small>
                                            </div>
                                        ` : '<p class="no-data">Nessuna attivit√† oggi</p>'}
                                    </div>
                                </div>
                                <div class="swipe-slide tomorrow-slide" id="tomorrow-slide-${combination.id}">
                                    <div class="current-info">
                                        <h4>Domani - ${currentData.tomorrow.day} <button class="mini-toggle-btn desktop-only" onclick="toggleDayView('${combination.id}')" style="float: right;">Vai a oggi</button></h4>
                                        ${currentData.tomorrow.menu ? `
                                            <div class="menu-list">
                                                <p class="menu-item">${currentData.tomorrow.menu.primo}</p>
                                                <p class="menu-item">${currentData.tomorrow.menu.secondo}</p>
                                                <p class="menu-item">${currentData.tomorrow.menu.frutta}</p>
                                            </div>
                                        ` : '<p class="no-data">Nessun menu domani</p>'}
                                        ${currentData.tomorrow.activity ? `
                                            <div class="activity-preview">
                                                <strong>Attivit√†:</strong><br>
                                                <small>${currentData.tomorrow.activity.replace(/<br>/g, ' ‚Ä¢ ')}</small>
                                            </div>
                                        ` : '<p class="no-data">Nessuna attivit√† domani</p>'}
                                    </div>
                                </div>
                            </div>
                            <div class="swipe-indicators">
                                <div class="swipe-indicator active" data-index="0"></div>
                                <div class="swipe-indicator" data-index="1"></div>
                            </div>
                        </div>
                        
                        <div class="combination-actions">
                            <button class="section-btn save" onclick="showFullMenu('${combination.menuType}', '${menuTypeName}')" style="flex: 1;">
                                üìã Menu
                            </button>
                            <button class="section-btn save" onclick="showFullActivities('${combination.activityGroup}', '${activityGroupName}')" style="flex: 1;">
                                üéØ Attivit√†
                            </button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            favoritesContent.innerHTML = html;
            
            // Initialize swipe handlers for mobile
            initSwipeHandlers();
        }

        // Track current view state for each combination (desktop)
        const dayViewState = {};

        // Desktop toggle function
        function toggleDayView(combinationId) {
            const todaySlide = document.getElementById(`today-slide-${combinationId}`);
            const tomorrowSlide = document.getElementById(`tomorrow-slide-${combinationId}`);
            const toggleBtn = document.getElementById(`toggle-btn-${combinationId}`);
            
            if (!todaySlide || !tomorrowSlide || !toggleBtn) return;
            
            const isShowingToday = !dayViewState[combinationId];
            dayViewState[combinationId] = isShowingToday;
            
            if (isShowingToday) {
                // Show tomorrow
                todaySlide.classList.add('hidden');
                tomorrowSlide.classList.add('visible');
                toggleBtn.textContent = 'Vai a oggi';
            } else {
                // Show today
                todaySlide.classList.remove('hidden');
                tomorrowSlide.classList.remove('visible');
                toggleBtn.textContent = 'Vai a domani';
            }
        }

        // Mobile swipe handlers
        function initSwipeHandlers() {
            const swipeContainers = document.querySelectorAll('.swipe-container');
            
            swipeContainers.forEach(container => {
                const combinationId = container.dataset.combinationId;
                const wrapper = container.querySelector('.swipe-wrapper');
                const indicators = container.querySelectorAll('.swipe-indicator');
                
                let startX = 0;
                let currentX = 0;
                let isDragging = false;
                let currentSlide = 0;
                
                // Check if mobile
                const isMobile = () => window.innerWidth <= 768;
                
                container.addEventListener('touchstart', (e) => {
                    if (!isMobile()) return;
                    startX = e.touches[0].clientX;
                    isDragging = true;
                    wrapper.style.transition = 'none';
                }, { passive: true });
                
                container.addEventListener('touchmove', (e) => {
                    if (!isDragging || !isMobile()) return;
                    currentX = e.touches[0].clientX;
                    const diff = currentX - startX;
                    const translateX = -currentSlide * 50 + (diff / container.offsetWidth) * 50;
                    wrapper.style.transform = `translateX(${Math.max(-50, Math.min(0, translateX))}%)`;
                }, { passive: true });
                
                container.addEventListener('touchend', (e) => {
                    if (!isDragging || !isMobile()) return;
                    isDragging = false;
                    wrapper.style.transition = 'transform 0.3s ease';
                    
                    const diff = currentX - startX;
                    const threshold = container.offsetWidth * 0.2;
                    
                    if (diff < -threshold && currentSlide === 0) {
                        // Swipe left - show tomorrow
                        currentSlide = 1;
                    } else if (diff > threshold && currentSlide === 1) {
                        // Swipe right - show today
                        currentSlide = 0;
                    }
                    
                    wrapper.style.transform = `translateX(${-currentSlide * 50}%)`;
                    
                    // Update indicators
                    indicators.forEach((ind, idx) => {
                        ind.classList.toggle('active', idx === currentSlide);
                    });
                });
            });
        }


        function getActivityGroupName(group) {
            const names = {
                'nido': 'Nido',
                'primavera': 'Primavera',
                'infanzia1': 'Infanzia 1',
                'infanzia2': 'Infanzia 2'
            };
            return names[group] || group;
        }

        function openDeleteModal(combinationId) {
            deleteTargetId = combinationId;
            const modal = document.getElementById('delete-modal');
            modal.classList.add('active');
        }

        function closeDeleteModal() {
            const modal = document.getElementById('delete-modal');
            modal.classList.remove('active');
            deleteTargetId = null;
        }

        function confirmDelete() {
            if (deleteTargetId) {
                combinations = combinations.filter(c => c.id !== deleteTargetId);
                saveCombinations();
                displayFavorites();
                closeDeleteModal();
            }
        }

        function deleteCombination(combinationId) {
            // This function is kept for compatibility but no longer used
            combinations = combinations.filter(c => c.id !== combinationId);
            saveCombinations();
            displayFavorites();
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function getCurrentMenuAndActivities(menuType, activityGroup) {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const currentWeek = getWeekNumber(today);
            const tomorrowWeek = getWeekNumber(tomorrow);
            
            const todayDay = getCurrentDay(today);
            const tomorrowDay = getCurrentDay(tomorrow);
            
            // Get menu data
            const menuData = menuType === 'nido' ? MENU_NIDO : MENU_INFANZIA;
            let todayMenu = null;
            let tomorrowMenu = null;
            
            if (menuData[currentWeek] && menuData[currentWeek][todayDay]) {
                todayMenu = menuData[currentWeek][todayDay];
            }
            
            if (menuData[tomorrowWeek] && menuData[tomorrowWeek][tomorrowDay]) {
                tomorrowMenu = menuData[tomorrowWeek][tomorrowDay];
            }
            
            // Get activities data
            const activitiesData = ACTIVITIES[activityGroup];
            let todayActivity = null;
            let tomorrowActivity = null;
            
            if (activitiesData && activitiesData[todayDay]) {
                const activities = activitiesData[todayDay];
                let content = '';
                
                if (activities.mattino && activities.pomeriggio) {
                    content = `Mattino: ${activities.mattino}<br>Pomeriggio: ${activities.pomeriggio}`;
                } else if (activities.mattino) {
                    content = `Mattino: ${activities.mattino}`;
                } else if (activities.pomeriggio) {
                    content = `Pomeriggio: ${activities.pomeriggio}`;
                } else {
                    content = 'Nessuna attivit√† programmata';
                }
                
                todayActivity = content;
            }
            
            if (activitiesData && activitiesData[tomorrowDay]) {
                const activities = activitiesData[tomorrowDay];
                let content = '';
                
                if (activities.mattino && activities.pomeriggio) {
                    content = `Mattino: ${activities.mattino}<br>Pomeriggio: ${activities.pomeriggio}`;
                } else if (activities.mattino) {
                    content = `Mattino: ${activities.mattino}`;
                } else if (activities.pomeriggio) {
                    content = `Pomeriggio: ${activities.pomeriggio}`;
                } else {
                    content = 'Nessuna attivit√† programmata';
                }
                
                tomorrowActivity = content;
            }
            
            return {
                today: { menu: todayMenu, activity: todayActivity, day: todayDay },
                tomorrow: { menu: tomorrowMenu, activity: tomorrowActivity, day: tomorrowDay }
            };
        }

        function createDayCard(day, menu, currentDay) {
            const dayCard = document.createElement('div');
            dayCard.className = 'day-card';
            
            if (day === currentDay) {
                dayCard.classList.add('today');
            }
            
            dayCard.innerHTML = `
                <h2>${day}</h2>
                <div class="menu-list">
                    <p class="menu-item">${menu.primo}</p>
                    <p class="menu-item">${menu.secondo}</p>
                    <p class="menu-item">${menu.frutta}</p>
                </div>
            `;
            
            return dayCard;
        }

        function createActivityDayCard(day, activities, currentDay) {
            const dayCard = document.createElement('div');
            dayCard.className = 'activity-day-card';
            
            if (day === currentDay) {
                dayCard.classList.add('today');
            }
            
            let html = `<h3>${day}</h3>`;
            
            // Add Mattino section if there's a morning activity
            if (activities.mattino) {
                html += `
                    <div class="activity-moment">
                        <div class="activity-moment-title">üåÖ Mattino</div>
                        <div class="activity-moment-content">${activities.mattino}</div>
                    </div>
                `;
            }
            
            // Add Pomeriggio section if there's an afternoon activity
            if (activities.pomeriggio) {
                html += `
                    <div class="activity-moment">
                        <div class="activity-moment-title">üåá Pomeriggio</div>
                        <div class="activity-moment-content">${activities.pomeriggio}</div>
                    </div>
                `;
            }
            
            // If no activities at all
            if (!activities.mattino && !activities.pomeriggio) {
                html += `
                    <div class="activity-moment">
                        <div class="activity-moment-content">Nessuna attivit√† programmata</div>
                    </div>
                `;
            }
            
            dayCard.innerHTML = html;
            
            return dayCard;
        }

        // Initialize app
        async function initApp() {
            console.log('Initializing app...');
            await loadWeekConfig();
            await loadMenuData();
            await loadActivitiesData();
            loadCombinations();
            
            // Display favorites on initial load
            displayFavorites();
            
            console.log('App initialized successfully');
        }

        // PWA Install functionality
        function showInstallPrompt() {
            const installContainer = document.getElementById('install-prompt-container');
            if (installContainer && deferredPrompt) {
                installContainer.style.display = 'block';
            }
        }

        function hideInstallPrompt() {
            const installContainer = document.getElementById('install-prompt-container');
            if (installContainer) {
                installContainer.style.display = 'none';
            }
        }

        async function installApp() {
            if (!deferredPrompt) {
                console.log('Install prompt not available');
                return;
            }

            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`User response to the install prompt: ${outcome}`);

            if (outcome === 'accepted') {
                console.log('App was installed');
                hideInstallPrompt();
            }

            deferredPrompt = null;
        }

        // Check if app is already installed
        function isAppInstalled() {
            return window.matchMedia('(display-mode: standalone)').matches || 
                   window.navigator.standalone === true;
        }

        // Full Menu Section functions
        function showFullMenu(menuType, menuTypeName) {
            const section = document.getElementById('full-menu-section');
            const title = document.getElementById('full-menu-title');
            const content = document.getElementById('full-menu-content');
            
            title.textContent = `Menu Completo - ${menuTypeName}`;
            
            // Display full menu for the selected type
            displayFullMenu(menuType, content);
            
            // Hide favorites and show menu section
            document.getElementById('favorites-section').classList.add('hidden');
            section.classList.remove('hidden');
        }

        function displayFullMenu(menuType, container) {
            const today = new Date();
            const currentWeek = getWeekNumber(today);
            const currentDay = getCurrentDay(today);
            
            container.innerHTML = '';
            
            const quickViewHeader = document.createElement('div');
            quickViewHeader.className = 'quick-view-header';
            quickViewHeader.innerHTML = `<h2>Settimana ${currentWeek}</h2>`;
            container.appendChild(quickViewHeader);
            
            const menuContainer = document.createElement('div');
            menuContainer.className = 'menu-container';
            
            const dayOrder = ['Luned√¨', 'Marted√¨', 'Mercoled√¨', 'Gioved√¨', 'Venerd√¨'];
            const menuData = menuType === 'nido' ? MENU_NIDO : MENU_INFANZIA;
            
            for (const day of dayOrder) {
                if (menuData[currentWeek] && menuData[currentWeek][day]) {
                    const dayCard = createDayCard(day, menuData[currentWeek][day], currentDay);
                    menuContainer.appendChild(dayCard);
                }
            }
            
            container.appendChild(menuContainer);
        }

        // Full Activities Section functions
        function showFullActivities(activityGroup, activityGroupName) {
            const section = document.getElementById('full-activities-section');
            const title = document.getElementById('full-activities-title');
            const content = document.getElementById('full-activities-content');
            
            title.textContent = `Attivit√† Complete - ${activityGroupName}`;
            
            // Display full activities for the selected group
            displayFullActivities(activityGroup, content);
            
            // Hide favorites and show activities section
            document.getElementById('favorites-section').classList.add('hidden');
            section.classList.remove('hidden');
        }

        function displayFullActivities(activityGroup, container) {
            const today = new Date();
            const currentDay = getCurrentDay(today);
            
            container.innerHTML = '';
            
            // Add header like menu section
            const quickViewHeader = document.createElement('div');
            quickViewHeader.className = 'quick-view-header';
            quickViewHeader.innerHTML = `<h2>Attivit√† Settimanali</h2>`;
            container.appendChild(quickViewHeader);
            
            const activitiesGrid = document.createElement('div');
            activitiesGrid.className = 'activities-grid';
            
            const dayOrder = ['Luned√¨', 'Marted√¨', 'Mercoled√¨', 'Gioved√¨', 'Venerd√¨', 'Sabato'];
            const activitiesData = ACTIVITIES[activityGroup];
            
            for (const day of dayOrder) {
                if (activitiesData && activitiesData[day]) {
                    const dayCard = createActivityDayCard(day, activitiesData[day], currentDay);
                    activitiesGrid.appendChild(dayCard);
                }
            }
            
            container.appendChild(activitiesGrid);
        }

        // Show favorites section
        function showFavorites() {
            // Hide all sections
            document.getElementById('full-menu-section').classList.add('hidden');
            document.getElementById('full-activities-section').classList.add('hidden');
            
            // Show favorites
            document.getElementById('favorites-section').classList.remove('hidden');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded');
            
            // Combination form submit
            document.getElementById('combination-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('combination-name').value;
                const menuType = document.getElementById('combination-menu').value;
                const activityGroup = document.getElementById('combination-activity').value;
                
                if (editingCombinationId) {
                    // Update existing combination
                    const index = combinations.findIndex(c => c.id === editingCombinationId);
                    if (index !== -1) {
                        combinations[index] = { ...combinations[index], name, menuType, activityGroup };
                    }
                } else {
                    // Create new combination
                    const newCombination = {
                        id: generateId(),
                        name,
                        menuType,
                        activityGroup,
                        createdAt: new Date().toISOString()
                    };
                    combinations.push(newCombination);
                }
                
                saveCombinations();
                displayFavorites();
                closeCombinationModal();
            });

            // Close existing modals when clicking on background
            document.getElementById('combination-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeCombinationModal();
                }
            });

            document.getElementById('delete-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeDeleteModal();
                }
            });

            // Close existing modals with ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeCombinationModal();
                    closeDeleteModal();
                }
            });

            // PWA Install button event
            const installBtn = document.getElementById('install-btn');
            if (installBtn) {
                installBtn.addEventListener('click', installApp);
            }

            // Check if app is already installed and hide install prompt if so
            if (isAppInstalled()) {
                hideInstallPrompt();
            } else {
                // Show install prompt after a short delay if app is not installed
                setTimeout(() => {
                    showInstallPrompt();
                }, 2000);
            }
            
            // Start app
            initApp();
        });

        // Listen for beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', function(e) {
            console.log('beforeinstallprompt fired');
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install prompt if not already installed
            if (!isAppInstalled()) {
                setTimeout(() => {
                    showInstallPrompt();
                }, 1000);
            }
        });

        // Listen for app installed event
        window.addEventListener('appinstalled', function() {
            console.log('App was installed');
            hideInstallPrompt();
            deferredPrompt = null;
        });
    </script>
    <script>
        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
</body>
</html>
